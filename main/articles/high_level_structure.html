<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="shrinkforest">
<title>High level structure â€¢ shrinkforest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="High level structure">
<meta property="og:description" content="shrinkforest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">shrinkforest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9013</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/hello.html">Hello</a>
    <a class="dropdown-item" href="../articles/high_level_structure.html">High level structure</a>
    <a class="dropdown-item" href="../articles/overview.html">High level structure</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/shrinkforest">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>High level structure</h1>
            
            <h4 data-toc-skip class="date">2023-01-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/shrinkforest/blob/HEAD/vignettes/high_level_structure.Rmd" class="external-link"><code>vignettes/high_level_structure.Rmd</code></a></small>
      <div class="d-none name"><code>high_level_structure.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/shrinkforest/" class="external-link">shrinkforest</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we are going to briefly describe the high level
structure of the functions used (the main ones and the helper ones) in
this package.</p>
<div class="section level2">
<h2 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h2>
<div class="section level3">
<h3 id="generate_stacked_data">Generate_stacked_data<a class="anchor" aria-label="anchor" href="#generate_stacked_data"></a>
</h3>
<p>The <code>generate_stacked_data</code> function is used to generate a
data frame with the data stacked by the subgroups.</p>
<p>We gather the columns of the different variables and we create two
columns: one with the subgroup variable and the other one with the value
of the subgroup variable. Doing this we are going to increase the number
of rows of the data frame (the new number of rows is going to be the
initial one times the number of subgroup variables). Finally, we sort
the rows of the new data frame by the subgroup and we output this sorted
data frame.</p>
</div>
<div class="section level3">
<h3 id="preprocess">Preprocess<a class="anchor" aria-label="anchor" href="#preprocess"></a>
</h3>
<p>The <code>preprocess</code> function is used to obtain from the
original data frame 3 different design matrices and a vector with the
name of the subgroups that are going to be studied.</p>
<p>The first of the matrices is <code>design_ia</code> which is the
design matrix of a model just with the interactions between treatment
and the subgrouping covariates.</p>
<p>Another matrix is <code>design_main</code> which is the design matrix
of a model with the main effects of treatment and the subgroup
variables.</p>
<p>The last matrix is <code>design_dummy</code> which is the matrix of a
model just with the subgrouping covariates and using one-hot
encoding.</p>
<p>To obtain all these matrices we just obtain the design matrices of
some specified models (for example just considering one of the
covariates) and when needed we bind them to obtain the three desired
matrices.</p>
<p>Finally we also obtain the vector <code>subgr_names</code> with the
exact name of the different subgroups that we are going to study.</p>
</div>
</div>
<div class="section level2">
<h2 id="main-functions">Main functions<a class="anchor" aria-label="anchor" href="#main-functions"></a>
</h2>
<div class="section level3">
<h3 id="naivepop">Naivepop<a class="anchor" aria-label="anchor" href="#naivepop"></a>
</h3>
<p>The <code>naivepop</code> function is used to estimate the subgroup
treatment effects with the naive overall population treatment
effect.</p>
<p>In this function we make a distinction depending on the type of data
that we have. In the case of survival data we fit a Cox regression model
(using coxph) with treatment as explanatory variable. Instead, if we
have binary data, we fit a logistic regression model (using glm with the
binomial family) with treatment as explanatory variable. This fitted
model is going to be included as part of the output of our function.</p>
</div>
<div class="section level3">
<h3 id="naive">Naive<a class="anchor" aria-label="anchor" href="#naive"></a>
</h3>
<p>The <code>naive</code>function is used to estimate the subgroup
treatment effects with the naive treatment effects per subgroup.</p>
<p>In this function we make a distinction between binary and survival
data (the main difference between them is that in binary we are going to
use glm models with the binomial family and in survival we are going to
use coxph models). With <code>generate_stacked_data</code> we obtain the
stacked by subgroups data frame and we fit a model (depending on the
type of response the glm or the coxph) on each one of the data sets
corresponding to a specific subgroup. These fitted models are going to
be part of the output as well as a data set with the components of the
summary of those models that are going to be useful to obtain the
treatment effect.</p>
</div>
<div class="section level3">
<h3 id="elastic_net">Elastic_net<a class="anchor" aria-label="anchor" href="#elastic_net"></a>
</h3>
<p>The <code>elastic_net</code> function is used to estimate the
subgroup treatment effects using penalization on the interaction terms
between treatment and the subgroup covariates.</p>
<p>We are going to use the function cv.glmnet to fit the model. We are
going to consider the design matrix (obtained after applying to the data
the function <code>preprocess</code>) with the main effects and the
interaction effects and we are going to create a penalty_factor vector
with entries 0 if the coefficients are not going to be penalized (as for
the main effects) and 1 if they are going to be penalized (as for the
interaction effects). Depending on the kind of data that we have we are
going to consider the cox family (for survival) or the binomial family
(for binary). The value of alpha is the elastic net mixing parameter and
can take values between 0 and 1. If we put it to 1 we are going to apply
lasso penalty on the interaction effects and if we put it to 0 we are
going to apply ridge penalty on the interaction effects.</p>
</div>
<div class="section level3">
<h3 id="horseshoe">Horseshoe<a class="anchor" aria-label="anchor" href="#horseshoe"></a>
</h3>
<p>The <code>horseshoe</code>function is used to estimate the subgroup
treatment effects using a bayesian model with a horseshoe prior on the
interaction terms between treatment and the subgroup covariates.</p>
<p>We are going to apply the function <code>preprocess</code> to our
data in order to obtain the design matrix needed to fit the model. Then
we use the brm function to fit our model and we are going to consider a
normal N(0,5) prior on the main effects and a regularized horseshoe
prior on the interaction effects. Depending on the kind of data we are
going to choose the cox family (for survival data) or the bernoulli
family (for binary data). In the case of survival data before fitting
the model we specify what is the shape (the boundary and the internal
knots) of the spline that is going to fit the baseline hazard.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary-functions">Summary functions<a class="anchor" aria-label="anchor" href="#summary-functions"></a>
</h2>
<p>With the <code>summary</code> function we are going to obtain the
estimated treatment effect of all the models fitted on the data.
Depending on the class of the fitted object we are going to apply
different functions:</p>
<div class="section level3">
<h3 id="summary-naivepop">Summary.naivepop<a class="anchor" aria-label="anchor" href="#summary-naivepop"></a>
</h3>
<p>The <code>summary.naivepop</code> function obtains the overall
treatment effect of the data given an object of class
<code>naivepop</code>.</p>
<p>If we have survival data the estimated overall hazard ratio is going
to be just the exponential of the coefficient of the cox model fitted on
the data. If we have binary data then the estimated overall log-odds
ratio is going to be the coefficient of the fitted model associated with
the treatment.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mar Vazquez Rabunal.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
