<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction • bonsaiforest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bonsaiforest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/high_level_structure.html">high_level_structure</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">overview</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/bonsaiforest/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/bonsaiforest/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/bonsaiforest/v0.1.0">v0.1.0</a> </div></li>
<!-- end dropdown for versions -->
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/bonsaiforest"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/bonsaiforest/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/bonsaiforest/" class="external-link">bonsaiforest</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we are going to show with an example how to use this
package.</p>
<p>We are going to consider a data set with time to event data and 10
categorical covariates. These categorical covariates define 25
subgroups. We are interested in estimating the subgroup treatment effect
(in this case the subgroup hazard ratio) of each one of these 25
subgroups. Here we will show an example where we only use 2 categorical
covariates in order to save run time. To do so we are going to use all
the methods available in this package and we are going to compare their
results using a forest plot.</p>
</div>
<div class="section level2">
<h2 id="data-analysis">Data analysis<a class="anchor" aria-label="anchor" href="#data-analysis"></a>
</h2>
<p>As it was mentioned before we are going to use survival data as an
example of how to use the package. In our data (that should be of class
<code>data.frame</code>) we should have columns with the following
variables:</p>
<ul>
<li><p>Treatment: factor variable with two levels (the first level
represents the control group and the second one the treatment group). It
is important to make sure that this variable is a factor and that the
levels are in the correct order.</p></li>
<li><p>Response: in the case of survival data this should be a numeric
variable with the survival time.</p></li>
<li><p>Status: in the case of survival data this variable should be
present and is a numeric variable with 0 and 1 indicating whether the
observation was censored or not.</p></li>
<li><p>Categorical variables: factor variables with information about
the individuals. The levels of these variables are going to be the
subgroups that we are interested in studying.</p></li>
</ul>
<p>In our case we have the following structure of the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1000 obs. of  14 variables:</span></span>
<span><span class="co">#&gt;  $ id    : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ arm   : Factor w/ 2 levels "0","1": 1 1 1 1 2 2 2 2 2 1 ...</span></span>
<span><span class="co">#&gt;  $ x_1   : Factor w/ 2 levels "a","b": 2 2 1 1 2 1 1 2 2 1 ...</span></span>
<span><span class="co">#&gt;  $ x_2   : Factor w/ 2 levels "a","b": 1 2 1 1 1 2 2 1 2 2 ...</span></span>
<span><span class="co">#&gt;  $ x_3   : Factor w/ 2 levels "a","b": 2 1 2 1 2 2 2 1 2 2 ...</span></span>
<span><span class="co">#&gt;  $ x_4   : Factor w/ 3 levels "a","b","c": 2 1 3 3 3 3 3 1 3 3 ...</span></span>
<span><span class="co">#&gt;  $ x_5   : Factor w/ 4 levels "a","b","c","d": 4 4 1 1 4 1 3 4 4 3 ...</span></span>
<span><span class="co">#&gt;  $ x_6   : Factor w/ 2 levels "a","b": 2 1 2 2 2 1 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ x_7   : Factor w/ 2 levels "a","b": 2 1 2 2 2 1 1 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ x_8   : Factor w/ 3 levels "a","b","c": 3 2 1 3 3 3 1 1 2 3 ...</span></span>
<span><span class="co">#&gt;  $ x_9   : Factor w/ 2 levels "a","b": 2 1 2 2 2 1 1 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ x_10  : Factor w/ 3 levels "a","b","c": 3 3 3 3 3 1 2 2 2 3 ...</span></span>
<span><span class="co">#&gt;  $ tt_pfs: num  0.9795 3.4762 1.7947 0.0197 2.2168 ...</span></span>
<span><span class="co">#&gt;  $ ev_pfs: num  1 0 1 1 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>We have that <code>arm</code> is our treatment variable,
<code>x_1</code> to <code>x_10</code> are the categorical covariates,
<code>tt_pfs</code> is the response variable and <code>ev_pfs</code> is
the status variable.</p>
<p>Once that we are sure that our data is in the correct format and
contains all the necessary variables, we are going to fit the different
models in order to obtain the subgroup treatment effects.</p>
</div>
<div class="section level2">
<h2 id="fit-models-and-check-summary">Fit Models and Check Summary<a class="anchor" aria-label="anchor" href="#fit-models-and-check-summary"></a>
</h2>
<div class="section level3">
<h3 id="naivepop">Naivepop<a class="anchor" aria-label="anchor" href="#naivepop"></a>
</h3>
<p>Let’s start by fitting the model that will lead to an overall
treatment effect estimation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naivepop_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/naivepop.html">naivepop</a></span><span class="op">(</span></span>
<span>  resp <span class="op">=</span> <span class="st">"tt_pfs"</span>,</span>
<span>  trt <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>,</span>
<span>  resptype <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  status <span class="op">=</span> <span class="st">"ev_pfs"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This new <code>naivepop</code> object contains the fitted model, the
kind of model that was fitted, the response type of the data and the
data.</p>
<p>We can take the summary of this object to obtain the overall
treatment effect estimate (in this case the overall hazard ratio).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_naivepop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">naivepop_model</span><span class="op">)</span></span>
<span><span class="va">summary_naivepop</span></span>
<span><span class="co">#&gt;     arm1 </span></span>
<span><span class="co">#&gt; 0.666919</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="naive">Naive<a class="anchor" aria-label="anchor" href="#naive"></a>
</h3>
<p>Now we are going to fit the model to obtain the naive
subgroup-specific treatment effects. We have to indicate which
categorical variables we want to consider to obtain the subgroup
treatment effects. If we add variable <code>x_1</code> we are going to
obtain the subgroup treatment effect of the subgroups <code>x_1a</code>
and <code>x_1b</code>. We do the same for <code>x_2</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/naive.html">naive</a></span><span class="op">(</span></span>
<span>  resp <span class="op">=</span> <span class="st">"tt_pfs"</span>, trt <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  subgr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_1"</span>, <span class="st">"x_2"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>, resptype <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  status <span class="op">=</span> <span class="st">"ev_pfs"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This <code>naive</code> object contains the fitted models for each
one of the subgroups, the main information about the coefficients
associated to treatment of these fitted models, the kind of models
fitted, the response type and the data.</p>
<p>We can take the summary of this object to obtain the subgroup
treatment effects. We can also include a value for the confidence level
in order to obtain confidence intervals for these subgroup treatment
effect estimates. By default this confidence level is of 95%.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">naive_model</span>, conf <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span></span>
<span><span class="va">summary_naive</span></span>
<span><span class="co">#&gt;   subgroup trt.estimate   trt.low  trt.high</span></span>
<span><span class="co">#&gt; 1     x_1a    0.6741880 0.4975147 0.9135999</span></span>
<span><span class="co">#&gt; 2     x_1b    0.6645867 0.4936858 0.8946489</span></span>
<span><span class="co">#&gt; 3     x_2a    0.7087873 0.5060265 0.9927928</span></span>
<span><span class="co">#&gt; 4     x_2b    0.6424496 0.4886396 0.8446746</span></span></code></pre></div>
<p>We can add a forest plot with the estimated treatment effects:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summary_naive</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="elastic-net">Elastic Net<a class="anchor" aria-label="anchor" href="#elastic-net"></a>
</h3>
<p>We are going to fit a model considering an elastic net penalization
on the subgroup treatment interaction coefficients. Depending on the
value of <code>alpha</code> we are going to have different kinds of
penalties. If we put <code>alpha</code> to 0 we consider a ridge penalty
and if we put <code>alpha</code> to 1 we consider a lasso penalty. We
are going to fit both lasso and ridge.</p>
<p>We have to add the <code>covars</code> argument which indicates which
categorical variables we want to include in our model. It is important
that all the variables that are in <code>subgr</code> are also in
<code>covars</code>. The idea is that we can include many variables but
then only find the subgroup treatment effect of some of them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ridge_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/elastic_net.html">elastic_net</a></span><span class="op">(</span></span>
<span>  resp <span class="op">=</span> <span class="st">"tt_pfs"</span>, trt <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  subgr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_1"</span>, <span class="st">"x_2"</span><span class="op">)</span>,</span>
<span>  covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>,</span>
<span>    <span class="st">"x_6"</span>, <span class="st">"x_7"</span>, <span class="st">"x_8"</span>, <span class="st">"x_9"</span>, <span class="st">"x_10"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>, resptype <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0</span>, status <span class="op">=</span> <span class="st">"ev_pfs"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lasso_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/elastic_net.html">elastic_net</a></span><span class="op">(</span></span>
<span>  resp <span class="op">=</span> <span class="st">"tt_pfs"</span>, trt <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  subgr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_1"</span>, <span class="st">"x_2"</span><span class="op">)</span>,</span>
<span>  covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>,</span>
<span>    <span class="st">"x_6"</span>, <span class="st">"x_7"</span>, <span class="st">"x_8"</span>, <span class="st">"x_9"</span>, <span class="st">"x_10"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>, resptype <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>, status <span class="op">=</span> <span class="st">"ev_pfs"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These <code>elastic_net</code> models contain the fitted models, the
response type, the data, the value of <code>alpha</code>, the design and
the dummy matrices (that are later going to be used to obtain the
subgroup treatment effects), the response and status variables and the
names of the subgroups.</p>
<p>We are now going to obtain the summary of these fitted objects to
find the subgroup hazard ratio estimates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_ridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ridge_model</span><span class="op">)</span></span>
<span><span class="va">summary_ridge</span></span>
<span><span class="co">#&gt;   subgroup trt.estimate</span></span>
<span><span class="co">#&gt; 1     x_1a    0.6502065</span></span>
<span><span class="co">#&gt; 2     x_1b    0.6493804</span></span>
<span><span class="co">#&gt; 3     x_2a    0.6495783</span></span>
<span><span class="co">#&gt; 4     x_2b    0.6501798</span></span>
<span><span class="va">summary_lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lasso_model</span><span class="op">)</span></span>
<span><span class="va">summary_lasso</span></span>
<span><span class="co">#&gt;   subgroup trt.estimate</span></span>
<span><span class="co">#&gt; 1     x_1a    0.6500483</span></span>
<span><span class="co">#&gt; 2     x_1b    0.6493824</span></span>
<span><span class="co">#&gt; 3     x_2a    0.6493749</span></span>
<span><span class="co">#&gt; 4     x_2b    0.6501893</span></span></code></pre></div>
<p>We can obtain a forest plot for each one of these fitted models:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summary_ridge</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summary_lasso</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-2.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="horseshoe-model">Horseshoe model<a class="anchor" aria-label="anchor" href="#horseshoe-model"></a>
</h3>
<p>We are now going to fit a Bayesian model with a horseshoe prior on
the subgroup-treatment interactions. Fitting this kind of models usually
takes a bit of time. We can modify some parameters like the number of
Markov chains, the number of iterations or the number of warmup
iterations (between others). The parameters that we can change are found
in the documentation of the <code>brm</code> function from the brms
package.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">horseshoe_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/horseshoe.html">horseshoe</a></span><span class="op">(</span></span>
<span>  resp <span class="op">=</span> <span class="st">"tt_pfs"</span>, trt <span class="op">=</span> <span class="st">"arm"</span>,</span>
<span>  subgr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_1"</span>, <span class="st">"x_2"</span><span class="op">)</span>,</span>
<span>  covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>,</span>
<span>    <span class="st">"x_6"</span>, <span class="st">"x_7"</span>, <span class="st">"x_8"</span>, <span class="st">"x_9"</span>, <span class="st">"x_10"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">example_data</span>,</span>
<span>  resptype <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>  status <span class="op">=</span> <span class="st">"ev_pfs"</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fl">800</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once that the model is fitted we have to check if there are
convergence problems. We might get divergent transitions after warmup.
In general if there are few divergent transitions (taking into account
the total number of iterations) and there are no other problems like
high <code>Rhat</code> values we can continue with our analysis.</p>
<p>We can obtain a summary of the posterior distributions of the
coefficients of the fitted model:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">horseshoe_model</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="co">#&gt;  Family: cox </span></span>
<span><span class="co">#&gt;   Links: mu = log </span></span>
<span><span class="co">#&gt; Formula: tt_pfs | cens(1 - ev_pfs) ~ a + b </span></span>
<span><span class="co">#&gt;          a ~ 0 + arm0 + arm1 + x_1b + x_2b + x_3b + x_4b + x_4c + x_5b + x_5c + x_5d + x_6b + x_7b + x_8b + x_8c + x_9b + x_10b + x_10c</span></span>
<span><span class="co">#&gt;          b ~ 0 + x_1a_arm + x_1b_arm + x_2a_arm + x_2b_arm + x_3a_arm + x_3b_arm + x_4a_arm + x_4b_arm + x_4c_arm + x_5a_arm + x_5b_arm + x_5c_arm + x_5d_arm + x_6a_arm + x_6b_arm + x_7a_arm + x_7b_arm + x_8a_arm + x_8b_arm + x_8c_arm + x_9a_arm + x_9b_arm + x_10a_arm + x_10b_arm + x_10c_arm</span></span>
<span><span class="co">#&gt;    Data: data_model (Number of observations: 1000) </span></span>
<span><span class="co">#&gt;   Draws: 2 chains, each with iter = 1000; warmup = 800; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 400</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; a_arm0         -0.28      0.41    -1.06     0.56 1.04       95      102</span></span>
<span><span class="co">#&gt; a_arm1         -0.76      0.54    -1.83     0.29 1.03       97      118</span></span>
<span><span class="co">#&gt; a_x_1b         -0.08      0.15    -0.35     0.18 1.02      347      254</span></span>
<span><span class="co">#&gt; a_x_2b          0.07      0.13    -0.20     0.32 1.00      531      313</span></span>
<span><span class="co">#&gt; a_x_3b         -0.32      0.17    -0.64     0.01 1.01      382      270</span></span>
<span><span class="co">#&gt; a_x_4b         -0.27      0.18    -0.64     0.07 1.00      351      282</span></span>
<span><span class="co">#&gt; a_x_4c         -0.56      0.19    -0.94    -0.21 1.01      340      270</span></span>
<span><span class="co">#&gt; a_x_5b          0.04      0.29    -0.44     0.80 1.00      152       88</span></span>
<span><span class="co">#&gt; a_x_5c         -0.13      0.25    -0.55     0.36 1.01      143       93</span></span>
<span><span class="co">#&gt; a_x_5d         -0.22      0.23    -0.60     0.30 1.00      137       82</span></span>
<span><span class="co">#&gt; a_x_6b          0.20      0.15    -0.12     0.51 1.00      313      262</span></span>
<span><span class="co">#&gt; a_x_7b          0.07      0.16    -0.25     0.35 1.00      332      312</span></span>
<span><span class="co">#&gt; a_x_8b          0.00      0.20    -0.39     0.37 1.00      289      205</span></span>
<span><span class="co">#&gt; a_x_8c         -0.01      0.18    -0.36     0.38 1.00      247      130</span></span>
<span><span class="co">#&gt; a_x_9b          0.10      0.20    -0.27     0.45 1.01      303      237</span></span>
<span><span class="co">#&gt; a_x_10b         0.18      0.22    -0.24     0.57 1.00      403      365</span></span>
<span><span class="co">#&gt; a_x_10c         0.15      0.20    -0.23     0.51 1.00      360      299</span></span>
<span><span class="co">#&gt; b_x_1a_arm     -0.00      0.10    -0.20     0.19 1.00      457      316</span></span>
<span><span class="co">#&gt; b_x_1b_arm     -0.01      0.11    -0.29     0.20 1.01      473      363</span></span>
<span><span class="co">#&gt; b_x_2a_arm      0.01      0.09    -0.16     0.25 1.00      325      281</span></span>
<span><span class="co">#&gt; b_x_2b_arm     -0.01      0.10    -0.27     0.18 1.00      435      215</span></span>
<span><span class="co">#&gt; b_x_3a_arm     -0.05      0.15    -0.43     0.09 1.02      270      225</span></span>
<span><span class="co">#&gt; b_x_3b_arm      0.04      0.13    -0.09     0.43 1.01      325      352</span></span>
<span><span class="co">#&gt; b_x_4a_arm     -0.02      0.10    -0.33     0.16 1.00      381      230</span></span>
<span><span class="co">#&gt; b_x_4b_arm     -0.02      0.13    -0.35     0.24 1.00      435      367</span></span>
<span><span class="co">#&gt; b_x_4c_arm      0.04      0.12    -0.10     0.42 1.01      324      255</span></span>
<span><span class="co">#&gt; b_x_5a_arm      0.10      0.25    -0.10     0.92 1.00      130       94</span></span>
<span><span class="co">#&gt; b_x_5b_arm     -0.07      0.19    -0.68     0.12 1.01      293      226</span></span>
<span><span class="co">#&gt; b_x_5c_arm     -0.03      0.10    -0.33     0.13 1.00      453      377</span></span>
<span><span class="co">#&gt; b_x_5d_arm      0.01      0.10    -0.26     0.22 1.00      515      366</span></span>
<span><span class="co">#&gt; b_x_6a_arm      0.02      0.11    -0.15     0.30 1.00      412      306</span></span>
<span><span class="co">#&gt; b_x_6b_arm     -0.03      0.11    -0.35     0.17 1.00      384      315</span></span>
<span><span class="co">#&gt; b_x_7a_arm     -0.07      0.16    -0.58     0.08 1.01      262      223</span></span>
<span><span class="co">#&gt; b_x_7b_arm      0.05      0.15    -0.13     0.55 1.01      270      220</span></span>
<span><span class="co">#&gt; b_x_8a_arm     -0.03      0.11    -0.41     0.13 1.00      420      335</span></span>
<span><span class="co">#&gt; b_x_8b_arm     -0.01      0.11    -0.28     0.19 1.02      336      317</span></span>
<span><span class="co">#&gt; b_x_8c_arm      0.04      0.12    -0.10     0.39 1.00      251      249</span></span>
<span><span class="co">#&gt; b_x_9a_arm     -0.04      0.14    -0.48     0.12 1.01      226      258</span></span>
<span><span class="co">#&gt; b_x_9b_arm      0.04      0.16    -0.19     0.54 1.01      418      308</span></span>
<span><span class="co">#&gt; b_x_10a_arm    -0.01      0.10    -0.26     0.22 1.00      440      313</span></span>
<span><span class="co">#&gt; b_x_10b_arm     0.00      0.08    -0.18     0.20 1.00      249      364</span></span>
<span><span class="co">#&gt; b_x_10c_arm    -0.02      0.10    -0.28     0.14 1.01      515      341</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>Apart from the fitted model this <code>horseshoe</code> object also
contains the data, the response, the design and dummy matrices, the kind
of response and the subgroup names.</p>
<p>We are now going to call summary of this object to obtain the
subgroup hazard ratio estimates. With this summary we are also going to
obtain the samples of the approximate posterior distribution of the
subgroup hazard ratios. The estimates are just the median of this
approximate posterior distribution. We should select a confidence level
in order to obtain credible intervals for the subgroup treatment
effects. The default confidence level is 95%.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_horseshoe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">horseshoe_model</span>, conf <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">summary_horseshoe</span></span>
<span><span class="co">#&gt;   subgroup trt.estimate   trt.low  trt.high</span></span>
<span><span class="co">#&gt; 1     x_1a    0.6548058 0.5396242 0.8285532</span></span>
<span><span class="co">#&gt; 2     x_1b    0.6555175 0.5250172 0.7978729</span></span>
<span><span class="co">#&gt; 3     x_2a    0.6527021 0.5215938 0.8296019</span></span>
<span><span class="co">#&gt; 4     x_2b    0.6479122 0.5427992 0.7976948</span></span></code></pre></div>
<p>We can obtain a forest plot with the treatment effect estimates and
the credible intervals.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summary_horseshoe</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-of-the-methods">Comparison of the Methods<a class="anchor" aria-label="anchor" href="#comparison-of-the-methods"></a>
</h2>
<p>A last useful thing that we can do is to compare the different
treatment effect estimates. For that we are first going to generate a
data set with all the estimated hazard ratios and then we are going to
plot all of them in a common forest plot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">naivepop_model</span>, <span class="va">naive_model</span>, <span class="va">ridge_model</span>, <span class="va">lasso_model</span>, <span class="va">horseshoe_model</span><span class="op">)</span></span>
<span><span class="va">comparison_data</span></span>
<span><span class="co">#&gt; $data</span></span>
<span><span class="co">#&gt;    subgroup trt.estimate   trt.low  trt.high                 model</span></span>
<span><span class="co">#&gt; 1      x_1a    0.6741880 0.4693783 0.9683648                 Naive</span></span>
<span><span class="co">#&gt; 2      x_1b    0.6645867 0.4663568 0.9470762                 Naive</span></span>
<span><span class="co">#&gt; 3      x_2a    0.7087873 0.4743926 1.0589952                 Naive</span></span>
<span><span class="co">#&gt; 4      x_2b    0.6424496 0.4636818 0.8901394                 Naive</span></span>
<span><span class="co">#&gt; 5      x_1a    0.6502065 0.6502065 0.6502065 Elastic net alpha = 0</span></span>
<span><span class="co">#&gt; 6      x_1b    0.6493804 0.6493804 0.6493804 Elastic net alpha = 0</span></span>
<span><span class="co">#&gt; 7      x_2a    0.6495783 0.6495783 0.6495783 Elastic net alpha = 0</span></span>
<span><span class="co">#&gt; 8      x_2b    0.6501798 0.6501798 0.6501798 Elastic net alpha = 0</span></span>
<span><span class="co">#&gt; 9      x_1a    0.6500483 0.6500483 0.6500483 Elastic net alpha = 1</span></span>
<span><span class="co">#&gt; 10     x_1b    0.6493824 0.6493824 0.6493824 Elastic net alpha = 1</span></span>
<span><span class="co">#&gt; 11     x_2a    0.6493749 0.6493749 0.6493749 Elastic net alpha = 1</span></span>
<span><span class="co">#&gt; 12     x_2b    0.6501893 0.6501893 0.6501893 Elastic net alpha = 1</span></span>
<span><span class="co">#&gt; 13     x_1a    0.6548058 0.5217772 0.8529706             Horseshoe</span></span>
<span><span class="co">#&gt; 14     x_1b    0.6555175 0.5070357 0.8349754             Horseshoe</span></span>
<span><span class="co">#&gt; 15     x_2a    0.6527021 0.5113236 0.9065121             Horseshoe</span></span>
<span><span class="co">#&gt; 16     x_2b    0.6479122 0.5240480 0.8121235             Horseshoe</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $overall_trt</span></span>
<span><span class="co">#&gt; [1] 0.666919</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $resptype</span></span>
<span><span class="co">#&gt; [1] "survival"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "compare.data"</span></span></code></pre></div>
<p>Now we plot all the estimated subgroup hazard ratios and we add a
vertical line indicating the value of the overall hazard ratio.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">comparison_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p>In the case of having survival data the procedure would be analogous
but instead of having survival <code>resptype</code> we would have
binary. Also the response variable should be a numeric variable with 1
and 0 and there would be no status variable.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mar Vazquez Rabunal, Daniel Sabanés Bové, Marcel Wolbers, Isaac Gravestock, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
